!function(e){tinymce.PluginManager.add("aiview",function(t){function o(e){return e.replace(/(\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]([^\[\]]+)\[\/aesop_[a-zA-Z_]+]|\[aesop_([a-zA-Z_]+)\s?([^\[\]]*)])/g,function(e){return n("aesop-component",e)})}function n(e,t){var o=/\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]([^\[\]]+)\[\/aesop_[a-zA-Z_]+]/g,n=/\[aesop_([a-zA-Z_]+)\s?([^\[\]]*)]/g,a=/(<\/p>[\s]*<p><\/p>\s<p>)[\s]*$/,s=/(<\/p>[\s]*<p>)[\s]*$/,c=o.exec(t);if(c){var p=i(c),d="string"==typeof p.title&&p.title.length>0?": "+p.title:"";c[3]=c[3].replace(a,""),c[3]=c[3].replace(s,"");var l='<div data-mce-resize="false" data-mce-placeholder="1" data-aesop-sc="'+window.encodeURIComponent(t)+'" class="mceItem aesop-component-long '+e+'"><div class="aesop-component-mask mceNonEditable unselectable" contenteditable="false"></div><div class="aesop-component-bar" contenteditable="false"><div class="aesop-component-controls"><div title="Delete Component" class="aesop-button aesop-button-delete">&nbsp;</div><div title="Clone Component" class="aesop-button aesop-button-clone">&nbsp;</div><div title="Edit Component" class="aesop-button aesop-button-edit aesop-scope-'+c[1]+'">&nbsp;</div><div title="Cut Component / CTRL + ALT + ENTER to Paste" class="aesop-button aesop-button-clipboard">&nbsp;</div></div><span class="mceNonEditable aesop-component-title unselectable aesop-'+c[1]+'-title">'+c[1].replace(/_/g," ")+d+'</span></div><div class="aesop-component-content aesop-'+c[1]+'"><p>'+c[3]+"</p></div></div>"}else{c=n.exec(t);var p=i(c),d="string"==typeof p.title&&p.title.length>0?": "+p.title:"",l='<div data-mce-resize="false" data-mce-placeholder="1" data-aesop-sc="'+window.encodeURIComponent(t)+'" class="mceItem aesop-component-short '+e+'"><div class="aesop-component-mask mceNonEditable unselectable" contenteditable="false"></div><div class="aesop-component-bar" contenteditable="false"><div class="aesop-component-controls"><div title="Delete Component" class="aesop-button aesop-button-delete">&nbsp;</div><div title="Clone Component" class="aesop-button aesop-button-clone">&nbsp;</div><div title="Edit Component" class="aesop-button aesop-button-edit aesop-scope-'+c[1]+'">&nbsp;</div><div title="Cut Component / CTRL + ALT + ENTER to Paste" class="aesop-button aesop-button-clipboard">&nbsp;</div></div><span class="mceNonEditable aesop-component-title unselectable aesop-'+c[1]+'-title">'+c[1].replace(/_/g," ")+d+'</span></div><div class="aesop-end">WcMgcq</div></div>'}return l}function a(e){return e.replace(/<div[^>]+?class="[^"]+?aesop-component-long.*?aesop-sc="([^"]+)"[\s\S]*?aesop-component-content[^>]*?>(.*?)<\/div>[\s]*?<\/div>|<div class="[^"+]+?aesop-component-short.*?aesop-sc="([^"]+)"[\s\S]*?WcMgcq<\/div><\/div>/g,function(e){return s(e)})}function s(e){var t=/<div[^>]+?class="[^"]+?aesop-component.*?aesop-sc="([^"]+)"[\s\S]*?aesop-component-content[^>]*?>(.*?)<\/div>[\s]*?<\/div>/g,o=/<div class="[^"+]+?aesop-component.*?aesop-sc="([^"]+)"[\s\S]*?WcMgcq<\/div><\/div>/g,n=/<div\s*class="clipboardControl[^>]+?><div\s*class="aesop[^>]+>\s*<\/div><\/div>/g;e=e.replace(n,"");var a=t.exec(e);if(a){var s=window.decodeURIComponent(a[1]),i=/\[[^\]]*\]([^\[]*)[^\]]*\]/,c=i.exec(s);return null!=c&&(a[2]=a[2].replace(/^<p>\W<\/p>/,""),s=s.replace(c[1],a[2])),"<p>"+s+"</p>"}if(a=o.exec(e),!a)return e;var s=window.decodeURIComponent(a[1]);return"<p>"+s+"</p>"}function i(e){var t=/\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]([^\[\]]+)\[\/aesop_[a-zA-Z]+]/g,o=/\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]/g,n=/<br data-mce-bogus="1">/g,a=/([^\s]+="[^"]+")/g,s=t.exec(e);if(!s&&(s=o.exec(e),!s))return e;for(var i,c=[];null!==(i=a.exec(s[2]));)c.push(i[1]);var p=[];return c.forEach(function(e){e=e.split(/=(.+)?/);var t=e[0],o=e[1];o=o.slice(0,-1),p[t]=o.substring(1)}),"undefined"!=typeof s[3]&&(p.content=s[3].replace(n,"")),p}function c(e){"none"!==e.style.display&&(e.style.display="none")}function p(e){"block"!==e.style.display&&(e.style.display="block")}function d(t){window.clipboardSource=t;var o=tinymce.activeEditor,n=o.dom.create("div",{"class":"clipboardControl mceNonEditable unselectable"},'<div class="aesop-button aesop-button-paste mceNonEditable unselectable" title="Ctrl + Alt + Enter to Paste">&nbsp;</div>');o.getBody().insertBefore(n,o.getBody().firstChild),window.clipboardControl=e(n)}function l(){var e=tinymce.activeEditor,t=e.dom.select(".clipboardControl");e.dom.remove(t),delete window.clipboard,delete window.clipboardSource,delete window.clipboardControl}function r(){var e=window.clipboardSource,t=tinymce.activeEditor;t.dom.remove(e),p(window.clipboard),t.execCommand("mceInsertRawHTML",!1,window.clipboard.outerHTML),l()}function u(e){tinymce.activeEditor;jQuery(e.outerHTML).insertAfter(e)}jQuery.fn.setCursorPosition=function(t){return 0==this.length?this:e(this).setSelection(t,t)},jQuery.fn.setSelection=function(e,t){if(0==this.length)return this;if(input=this[0],input.createTextRange){var o=input.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",e),o.select()}else input.setSelectionRange&&(input.focus(),input.setSelectionRange(e,t));return this},jQuery.fn.focusEnd=function(){return this.setCursorPosition(this.val().length),this},t.onClick.add(function(t,o){if(delete window.ailocked,delete window.aiactive,"undefined"!=typeof e(t.selection.getNode()).parents(".aesop-component")[0]&&(window.aiactive=!0),o.target.className.indexOf("aesop-button-delete")>-1){var n=confirm("Are you sure you want to delete this Aesop Component?");n===!0&&o.target.parentNode.parentNode.parentNode.parentNode.removeChild(o.target.parentNode.parentNode.parentNode),delete window.aiactive,window.ailocked=!0,tinymce.execCommand("mceFocus",!1,t.id)}if(o.target.className.indexOf("aesop-button-edit")>-1){var s=/aesop-scope-([a-z_]*)/,p=s.exec(o.target.className),l=o.target.parentNode.parentNode.parentNode,r=l.getAttribute("data-aesop-sc");if(r?(r=window.decodeURIComponent(r),r="<p>"+r+"</p>"):r=a(l.outerHTML),l.setAttribute("id","aesop-generator-editing"),p){e("body").toggleClass("modal-open"),e("body").addClass("modal-updating"),e("#aesop-generator-wrap").toggleClass("aesop-generator-open");var v=".dk_options li."+p[1]+" a";e(v).click();var m=i(r);for(var b in m)"content"===b?e("#aesop-generator-content").val(m[b]):e('#aesop-generator-settings [name="'+b+'"]').val(m[b])}tiny_ai_parent=t.dom.select("#aesop-generator-editing")[0],t.selection.select(tiny_ai_parent),t.selection.collapse(!1)}if(o.target.className.indexOf("aesop-button-clipboard")>-1){var l=o.target.parentNode.parentNode.parentNode;window.clipboard=l,c(l),d(l),t.selection.collapse(!1)}if(o.target.className.indexOf("aesop-button-clone")>-1){var l=o.target.parentNode.parentNode.parentNode;u(l),t.selection.collapse(!1)}}),t.onKeyDown.add(function(t,o){if(delete window.ailocked,13===o.keyCode&&!o.ctrlKey&&!o.shiftKey&&!o.altKey){var n=t.selection.getNode(),a=e(n).parents(".aesop-component");if(e(n).parents(".aesop-component")[0]){o.preventDefault(),o.stopPropagation();var s=e("<p><br/></p>").insertAfter(a);s.uniqueId();var i=s.attr("id"),c=t.dom.select("#"+i)[0];t.selection.setCursorLocation(c)}}o.ctrlKey&&o.altKey&&13===o.keyCode&&(o.preventDefault(),o.stopPropagation(),"undefined"==typeof window.clipboard?alert("Clipboard is empty"):"undefined"!=typeof window.aiactive?alert("Please do not paste into an existing aesop component"):r())}),t.onKeyUp.add(function(t,o){"undefined"!=typeof e(t.selection.getNode()).parents(".aesop-component")[0]?window.aiactive=!0:delete window.aiactive}),t.on("BeforeSetContent",function(e){e.content=o(e.content)}),t.on("PostProcess",function(e){e.get&&(e.content=a(e.content))})})}(window.jQuery);
//# sourceMappingURL=plugin.min.js.map