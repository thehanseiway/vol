jQuery(document).ready(function($) {
	$('.cq-medium-gallery').each(function(index) {
		var _this = $(this);
		var _maxRowHeight = $(this).data('maxrowheight') || '100%';
		var _margins = $(this).data('gutter') || '0';
		var _rowHeight = $(this).data('rowheight') || '200';
		var _background = $(this).data('background') || 'rgba(255,255,255,0.85)';

		$(this).justifiedGallery({
			  maxRowHeight: _maxRowHeight,
			  // Set the gutter between columns and rows
			  margins: _margins,
			  // Manually set the grid layout
			  //layout: _layoutno,
			  // Wrap the images in links
			  //highresLinks: false,
			  // Asign a common rel attribute
			  // rel: 'print-gallery',
			  rowHeight: _rowHeight,
			  waitThumbnailsLoad: true,
			  lastRow: 'justify'
		}).on('jg.complete', function(){
			  // Show the grid after it renders
			  // _this.attr('style', '');
			  // _this.find('.mediumgallery-item').fluidbox({
			  // 	stackIndex: 3
			  // });
			//   _this.find('img.mediumgallery-img').each(function(index) {
			// 	  var $this = $(this);
			// 	  var _imgurl = $this.data('highres');
			// 	  var _galleryitem = $this.wrap('<a href="'+_imgurl+'" class="mediumgallery-item"></a>');
			// 	  var _rowHeight = $this.closest('.photoset-row').height();
			  //
			// 	  $this.closest('.photoset-row').css('overflow','visible');
			  //
			// 	  $this.css( {
			// 		  'max-height': _rowHeight,
			// 		  'margin-top': 0
			// 	  });
			//   });
			$( this ).magnificPopup({
				delegate: 'a',
				type: 'image',
				closeOnContentClick: true,
				closeBtnInside: false,
				mainClass: 'mfp-with-zoom mfp-img-mobile',
				image: {
					verticalFit: true
				},
				zoom: {
					enabled: true,
					duration: 150, // don't foget to change the duration also in CSS
					opener: function(element) {
						return element.find('img');
					}
				}

			});
		});
	});
});
